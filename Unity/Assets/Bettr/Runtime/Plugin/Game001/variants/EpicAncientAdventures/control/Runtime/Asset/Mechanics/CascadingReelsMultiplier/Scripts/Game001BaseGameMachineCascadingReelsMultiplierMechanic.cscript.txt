require "math"
require "Core"

Game001BaseGameMachineCascadingReelsMultiplierMechanic = {
    State = {
        MechanicsPrefab = nil
    }
}

function Game001BaseGameMachineCascadingReelsMultiplierMechanic:new(o)
	o = o or {}
	setmetatable(o, self)
	self.__index = self
	return o
end

function Game001BaseGameMachineCascadingReelsMultiplierMechanic:Initialize(machine)
    series
        do
            local manifest = Game001.Manifest
            local prefabName = "BaseGameMachineCascadingReelsMultiplier"
            local parentGameObject = machine.MechanicsParent.GameObject
            System.Print("Game001BaseGameMachineCascadingReelsMultiplierMechanic:Initialize before manifest.BundleName={0} manifest.BundleVersion={1} prefabName={2} parentGameObject={3}", manifest.BundleName, manifest.BundleVersion, prefabName, parentGameObject.name)    
            local mechanicsPrefab = BettrAssetController.LoadPrefab(manifest.BundleName, manifest.BundleVersion, prefabName, parentGameObject)
            mechanicsPrefab.SetActive(false)
            self.State.MechanicsPrefab = mechanicsPrefab
            System.Print("Game001BaseGameMachineCascadingReelsMultiplierMechanic:Initialize mechanicsPrefab={0}", mechanicsPrefab.name)            
        end
    end
end

function Game001BaseGameMachineCascadingReelsMultiplierMechanic:BaseGamePayout(machine, cascadeID)
    series
        do
            local isTriggered = Game001BaseGameCascadingReelsMultiplierSummary.CascadingReelsMultiplier.First.Triggered
            System.Print("Game001BaseGameMachineCascadingReelsMultiplierMechanic BaseGamePayout cascadeID={0} isTriggered={1}", cascadeID, isTriggered)
            if not isTriggered then
                return
            end
            local arr = Game001BaseGameCascadingReelsMultiplier.CascadingReelsMultiplier.Array
            for i = 1, #arr do
                local cascadingReelsMultiplier = arr[i]
                local thisCascadeID = cascadingReelsMultiplier.Cascade
                if thisCascadeID == cascadeID then                    
                    self.State.MechanicsPrefab.SetActive(true)
                    local multiplier = cascadingReelsMultiplier.Multiplier
                    local pays = cascadingReelsMultiplier.Pays
                    local totalPays = cascadingReelsMultiplier.TotalPays
                    System.WaitForFrame(1)                    
                    local textProperty = machine.BaseGameCascadingReelsMultiplierText
                    System.Print("Game001BaseGameMachineCascadingReelsMultiplierMechanic BaseGamePayout cascadeID={0} multiplier={1} pays={2} totalPays={3} textProperty={4}", cascadeID, multiplier, pays, totalPays, textProperty)
                    textProperty.SetText("" .. pays)
                    BettrVisualsController.FireballMoveTo(machine.WinText.GameObject, 10, 2)
                end
            end
        end
    end
end

function Game001BaseGameMachineCascadingReelsMultiplierMechanic:TryPaying(machine)
end


